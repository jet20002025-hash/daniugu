# 🚀 GitHub + Cloudflare + Vercel 快速部署指南

## 📋 部署前准备

### 1. 创建 GitHub 仓库

```bash
# 在项目目录下执行
git init
git add .
git commit -m "Initial commit: 股票分析系统"

# 在 GitHub 创建新仓库后，执行：
git remote add origin https://github.com/你的用户名/仓库名.git
git branch -M main
git push -u origin main
```

### 2. 已创建的文件

✅ `vercel.json` - Vercel 配置文件
✅ `api/index.py` - Vercel serverless 函数入口
✅ `requirements.txt` - Python 依赖包
✅ `.vercelignore` - 忽略不需要部署的文件
✅ `.gitignore` - Git 忽略文件

## 🎯 部署步骤

### 步骤 1: 连接 Vercel

1. 访问 [vercel.com](https://vercel.com)
2. 使用 GitHub 账号登录
3. 点击 **"New Project"**
4. 选择你的 GitHub 仓库
5. Vercel 会自动检测配置

### 步骤 2: 配置项目

**框架预设**: 选择 "Other" 或让 Vercel 自动检测

**环境变量**（如果需要）:
- `PYTHON_VERSION=3.9`

**构建命令**: 留空（Vercel 会自动处理）

**输出目录**: 留空

### 步骤 3: 部署

点击 **"Deploy"**，Vercel 会：
1. 安装依赖（从 `requirements.txt`）
2. 构建项目
3. 部署到生产环境

### 步骤 4: 获取部署地址

部署完成后，你会得到一个地址：
- `https://你的项目名.vercel.app`

## 🌐 配置 Cloudflare

### 1. 添加域名到 Cloudflare

1. 登录 [Cloudflare](https://dash.cloudflare.com)
2. 添加你的域名
3. 按照提示更新 DNS 服务器

### 2. 配置 DNS 记录

在 Cloudflare DNS 设置中添加：

**类型**: CNAME
**名称**: @ 或 www
**目标**: `cname.vercel-dns.com`
**代理状态**: 🟠 已代理（橙色云朵）

### 3. SSL/TLS 设置

1. 进入 **SSL/TLS** 设置
2. 选择 **"Full"** 模式
3. 确保 **"Always Use HTTPS"** 已启用

### 4. 页面规则（可选）

可以添加缓存规则来加速静态资源：
- `*.css` - 缓存 1 个月
- `*.js` - 缓存 1 个月
- `*.png|jpg|jpeg|gif` - 缓存 1 个月

## ⚠️ 重要注意事项

### Vercel 限制

1. **执行时间限制**:
   - Hobby: 10秒
   - Pro: 60秒 ⭐（推荐）
   - Enterprise: 300秒

2. **当前应用的问题**:
   - 扫描股票功能可能需要很长时间
   - 后台任务在 serverless 环境中可能不稳定

### 解决方案

**方案 A: 异步处理**（推荐）
- 将长时间任务改为异步
- 使用轮询查询进度
- 或使用 Vercel Background Functions

**方案 B: 混合架构**
- 前端部署到 Vercel
- 后台任务部署到 Railway/Render/Fly.io

**方案 C: 升级计划**
- 升级到 Vercel Pro（60秒）
- 或 Enterprise（300秒）

## 🔧 代码调整建议

由于扫描任务可能超时，建议修改：

1. **扫描 API 改为异步**:
   ```python
   # 立即返回任务ID
   @app.route('/api/scan_all_stocks', methods=['POST'])
   def scan_all_stocks():
       task_id = start_scan_task()  # 后台启动
       return jsonify({'task_id': task_id})
   
   # 轮询查询进度
   @app.route('/api/get_scan_progress/<task_id>')
   def get_scan_progress(task_id):
       return jsonify(get_task_status(task_id))
   ```

2. **使用外部存储**:
   - Vercel KV（键值存储）
   - Upstash Redis
   - 数据库（PostgreSQL）

## 📝 测试部署

部署完成后，访问你的域名测试：

1. ✅ 首页是否正常显示
2. ✅ API 是否正常响应
3. ⚠️ 扫描功能是否超时（可能需要调整）

## 🐛 常见问题

### 问题 1: 部署失败

**检查**:
- `requirements.txt` 是否正确
- Python 版本是否兼容
- 查看 Vercel 部署日志

### 问题 2: 超时错误

**解决**:
- 将长时间任务改为异步
- 升级 Vercel 计划
- 使用外部服务处理后台任务

### 问题 3: 静态资源 404

**解决**:
- 检查 `static/` 目录是否在仓库中
- 检查 `vercel.json` 路由配置

## 📊 监控

- **Vercel Dashboard**: 查看部署状态、日志、分析
- **Cloudflare Analytics**: 查看访问统计、性能
- **Vercel Logs**: 实时查看应用日志

## 🔄 更新部署

每次推送到 GitHub，Vercel 会自动：
1. 检测代码变更
2. 重新构建
3. 部署新版本

也可以手动触发：
- Vercel Dashboard → Deployments → Redeploy

## 💰 费用

- **Vercel Hobby**: 免费（有限制）
- **Vercel Pro**: $20/月（推荐，60秒限制）
- **Cloudflare**: 免费（基础功能）

## 📞 需要帮助？

1. 查看 [Vercel 文档](https://vercel.com/docs)
2. 查看 [Cloudflare 文档](https://developers.cloudflare.com)
3. 查看部署日志排查问题

---

**下一步**: 按照步骤部署，如果遇到问题，查看详细日志或联系我！



