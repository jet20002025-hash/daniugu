# 通达信数据导入指南

## 📋 概述

通达信软件盘后会自动下载股票数据，存储为 `.day` 二进制文件。本工具可以将这些数据转换为系统可用的 CSV 格式。

## 📂 通达信数据存储位置

### Windows 系统
- **上海证券交易所**: `C:\new_tdx\vipdoc\sh\lday`
- **深圳证券交易所**: `C:\new_tdx\sz\lday`
- **扩展行情**（含港股）: `C:\new_tdx\vipdoc\ds\lday`

### Mac 系统
- 通常在安装目录下的 `vipdoc` 文件夹
- 例如: `/Users/用户名/通达信/vipdoc/sh/lday`

### 文件格式
- 文件命名: `sh600000.day`（上海）或 `sz000001.day`（深圳）
- 文件格式: 二进制格式，每32字节代表一天数据

## 🚀 使用方法

### 方法1: 命令行运行

```bash
# 转换上海股票数据
python3 import_tdx_data.py /path/to/vipdoc/sh/lday

# 转换深圳股票数据
python3 import_tdx_data.py /path/to/vipdoc/sz/lday
```

### 方法2: 交互式运行

```bash
python3 import_tdx_data.py
# 然后按提示输入通达信数据目录路径
```

## ✨ 功能特点

1. **自动识别股票代码**: 从文件名中提取股票代码（如 `sh600000.day` → `600000`）
2. **数据合并**: 如果CSV文件已存在，会自动合并新数据（去重、排序）
3. **生成周K线**: 自动从日K线数据生成周K线数据
4. **更新标记**: 自动更新数据标记文件，记录最新数据日期
5. **批量处理**: 一次性处理目录中的所有 `.day` 文件

## 📊 数据格式

转换后的CSV文件包含以下列：
- `日期`: YYYY-MM-DD 格式
- `开盘`: 开盘价
- `收盘`: 收盘价
- `最高`: 最高价
- `最低`: 最低价
- `成交量`: 成交量（股数）
- `成交额`: 成交额（元）

## ⚠️ 注意事项

1. **数据覆盖**: 如果CSV文件已存在，新数据会合并到现有数据中（不会覆盖）
2. **数据去重**: 相同日期的数据会自动去重（保留最新的）
3. **日期排序**: 数据会自动按日期排序
4. **文件权限**: 确保有读取通达信数据目录的权限

## 🔍 检查转换结果

转换完成后，数据会保存到：
- **日K线**: `cache/daily_kline/[股票代码].csv`
- **周K线**: `cache/weekly_kline/[股票代码].csv`
- **数据标记**: `cache/data_markers.json`

## 💡 使用建议

1. **定期更新**: 建议每天盘后运行一次，更新最新数据
2. **备份数据**: 转换前建议备份现有的CSV文件
3. **分批处理**: 如果数据量很大，可以分批处理（先处理上海，再处理深圳）

## 🐛 常见问题

### Q: 找不到通达信数据目录？
A: 检查通达信安装目录，通常在 `vipdoc` 文件夹下

### Q: 转换失败？
A: 检查文件权限，确保有读取权限

### Q: 数据不完整？
A: 检查 `.day` 文件是否完整，可能需要在通达信软件中重新下载数据

### Q: 如何验证数据是否正确？
A: 打开生成的CSV文件，检查日期、价格等数据是否合理

## 📝 示例输出

```
============================================================
📊 通达信数据导入工具
============================================================

📁 找到 5000 个 .day 文件
📂 输出目录: cache/daily_kline

✅ 600000: 转换成功，共 2500 条数据，最新日期: 2026-01-22
✅ 600001: 转换成功，共 2500 条数据，最新日期: 2026-01-22
...

============================================================
转换完成！成功: 5000, 失败: 0, 跳过: 0
============================================================
```
